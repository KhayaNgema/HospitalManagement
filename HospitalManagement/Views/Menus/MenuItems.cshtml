@model IEnumerable<HospitalManagement.Models.MenuItem>
@inject HospitalManagement.Interfaces.IEncryptionService encryptionService

@{
    ViewData["Title"] = "Menu Items";
    Layout = "~/Views/Shared/_PagesLayout.cshtml";
}

<style>
    .btn-details {
        border: 1px solid #e0e0e0;
        border-radius: 5px;
    }

        .btn-details:hover {
            background-color: #16562b;
            color: #ffffff;
        }

        .btn-details i {
            margin-right: 5px;
        }

    .btn-create {
        border: 2px solid #e0e0e0;
        border-radius: 5px;
        background-color:#16562b;
        color:white;
    }

        .btn-create:hover {
            background-color: #42d44a;
            color: #ffffff;
        }

        .btn-create i {
            margin-right: 5px;
        }

    .btn-store-view {
        border: 2px solid #e0d8d8;
        border-radius: 5px;
        background-color: #16562b;
        color: #ffffff;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }

        .btn-store-view:hover {
            background-color: #42d44a;
            color: #ffffff;
        }

        .btn-store-view i {
            margin-right: 8px;
        }


    .no-items-message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

</style>

<div class="d-flex align-items-center justify-content-between px-3 py-3 mb-4" style="background-color:#48AAAD;">
    <h2 class="mb-0 text-white">Menu Items</h2>
</div>

<div class="container">
    
</div>

<br />
<div class="d-flex justify-content-between align-items-center mb-4 px-3">

    <div class="input-group w-50 me-2">
        <input type="text" class="form-control" placeholder="Search by item name or price" id="qrSearchInput">
    </div>

    <div class="input-group w-25 me-2">
        <select id="categoryDropdown" class="form-select custom-select">
            <option value="">All Categories</option>
            @foreach (var category in ViewBag.Categories)
            {
                <option value="@category.CategoryId">@category.CategoryName</option>
            }
        </select>
    </div>

    <a asp-controller="MenuItems" asp-action="NewItem" class="btn btn-primary" id="addButton">
        <i class="bi bi-plus-circle me-1"></i> New item
    </a>


</div>

@if (!Model.Any())
{
    <div class="alert alert-info text-center">
        No menu items found.
    </div>
}
else
{
    <table class="table" id="itemTable">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.First().ItemName)</th>
                <th>@Html.DisplayNameFor(model => model.First().ItemDescription)</th>
                <th>@Html.DisplayNameFor(model => model.First().Price)</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr data-category="@item.CategoryId">
                    <td>@Html.DisplayFor(modelItem => item.ItemName)</td>
                    <td>@Html.DisplayFor(modelItem => item.ItemDescription)</td>
                    <td>@Html.DisplayFor(modelItem => item.Price)</td>
                    <td>
                        @if (!string.IsNullOrEmpty(item.ItemImage))
                        {
                            <img src="~/UploadedFiles/@item.ItemImage" alt="@item.ItemName" class="img-thumbnail img-fluid" style="max-width: 100px; max-height: 100px;" />
                        }
                        else
                        {
                            <text>No image available</text>
                        }
                    </td>
                    <td>
                        <a href="@Url.Action("Details", new { itemId = item.ItemId })" class="btn btn-details">
                            <i class="fas fa-info-circle"></i> Details
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}


@section scripts {
    <script>
        $(document).ready(function () {
            function filterItems(categoryId) {
                $('#itemTable tbody tr').hide(); 
                if (categoryId === '') {
                    $('#itemTable tbody tr').show();
                } else {
                    $('#itemTable tbody tr[data-category="' + categoryId + '"]').show();
                }

                if ($('#itemTable tbody tr:visible').length === 0) {
                    $('#noItemsMessage').show();
                } else {
                    $('#noItemsMessage').hide();
                }
            }

            $('#categoryDropdown').change(function () {
                var categoryId = $(this).val(); 
                filterItems(categoryId);
            });

            filterItems('');

            $('#searchInput').on('input', function () {
                var searchText = $(this).val().toLowerCase();
                $('#itemTable tbody tr').hide();
                $('#itemTable tbody tr').each(function () {
                    var item = $(this).text().toLowerCase();
                    if (item.includes(searchText)) {
                        $(this).show();
                    }
                });
                if ($('#itemTable tbody tr:visible').length === 0) {
                    $('#noItemsMessage').show();
                } else {
                    $('#noItemsMessage').hide();
                }
            });
        });
    </script>
}


